<!--history.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ç»Ÿè®¡ -->
  <view class="header-stats">
    <view class="stats-row">
      <view class="stats-card">
        <view class="stats-number">{{totalCount}}</view>
        <view class="stats-label">æ€»è®¡</view>
      </view>
      <view class="stats-card">
        <view class="stats-number correct">{{correctCount}}</view>
        <view class="stats-label">æ­£ç¡®</view>
      </view>
      <view class="stats-card">
        <view class="stats-number incorrect">{{incorrectCount}}</view>
        <view class="stats-label">é”™è¯¯</view>
      </view>
      <view class="stats-card">
        <view class="stats-number">{{accuracyRate}}%</view>
        <view class="stats-label">æ­£ç¡®ç‡</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰é€‰é¡¹ -->
  <view class="filter-bar">
    <view class="filter-section">
      <text class="filter-title">ç­›é€‰ï¼š</text>
      <view class="filter-options">
        <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="all">å…¨éƒ¨</view>
        <view class="filter-item {{currentFilter === 'correct' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="correct">æ­£ç¡®</view>
        <view class="filter-item {{currentFilter === 'incorrect' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="incorrect">é”™è¯¯</view>
      </view>
    </view>
    
    <view class="clear-section">
      <view class="clear-btn" bindtap="onClearHistory">
        <text class="clear-text">æ¸…ç©º</text>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <scroll-view class="history-list" scroll-y enhanced="true" refresher-enabled="true" bindrefresherrefresh="onRefresh" refresher-triggered="{{refreshing}}">
    <view class="list-content">
      <!-- æŒ‰æ—¥æœŸåˆ†ç»„ -->
      <view class="date-group" wx:for="{{groupedHistory}}" wx:key="date">
        <view class="date-header">
          <text class="date-text">{{item.date}}</text>
          <text class="date-count">{{item.records.length}}é¢˜</text>
        </view>
        
        <view class="history-item" wx:for="{{item.records}}" wx:key="id" wx:for-item="record" bindtap="onQuestionTap" data-question="{{record}}">
          <view class="item-left">
            <view class="result-indicator {{record.isCorrect ? 'correct' : 'incorrect'}}">
              <text class="result-icon">{{record.isCorrect ? 'âœ“' : 'âœ—'}}</text>
            </view>
          </view>
          
          <view class="item-content">
            <view class="question-title">{{record.title}}</view>
            <view class="question-meta">
              <text class="difficulty difficulty-{{record.difficulty}}">{{record.difficultyText}}</text>
              <text class="answer-time">{{record.answerTime}}</text>
            </view>
          </view>
          
          <view class="item-right">
            <view class="action-menu" bindtap="onShowActionMenu" data-record="{{record}}" catch:tap="true">
              <text class="menu-icon">â‹¯</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredHistory.length === 0 && !refreshing}}">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">{{history.length === 0 ? 'è¿˜æ²¡æœ‰ç­”é¢˜è®°å½•' : 'æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•'}}</text>
        <text class="empty-desc">{{history.length === 0 ? 'å¿«å»åˆ·é¢˜å§' : 'å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶'}}</text>
        <view class="empty-action" wx:if="{{history.length === 0}}" bindtap="goToQuestionBank">
          <text class="action-text">å¼€å§‹åˆ·é¢˜</text>
        </view>
      </view>
    </view>
  </scroll-view>
</view>

<!-- æ“ä½œèœå•å¼¹çª— -->
<view class="action-modal {{showActionModal ? 'show' : ''}}" wx:if="{{showActionModal}}">
  <view class="modal-overlay" bindtap="onCloseActionModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">{{selectedRecord.title}}</text>
      <view class="modal-close" bindtap="onCloseActionModal">Ã—</view>
    </view>
    <view class="modal-actions">
      <view class="action-item" bindtap="onViewQuestion">
        <text class="action-icon">ğŸ‘€</text>
        <text class="action-name">æŸ¥çœ‹é¢˜ç›®</text>
      </view>
      <view class="action-item" bindtap="onToggleCollect">
        <text class="action-icon">{{selectedRecord.isCollected ? 'â­' : 'â˜†'}}</text>
        <text class="action-name">{{selectedRecord.isCollected ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—é¢˜ç›®'}}</text>
      </view>
      <view class="action-item delete" bindtap="onDeleteRecord">
        <text class="action-icon">ğŸ—‘ï¸</text>
        <text class="action-name">åˆ é™¤è®°å½•</text>
      </view>
    </view>
  </view>
</view>
